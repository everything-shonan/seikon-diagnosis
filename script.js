
// 成婚力診断コメント・営業脳アドバイス（本番用）
const scores = JSON.parse(sessionStorage.getItem("diagnosisScores")) || {};
const radarLabels = ["印象力", "共感力", "観察力", "洞察力", "提案力", "表現力", "会話力", "進展力"];
const radarKeys = ["impression", "empathy", "observation", "insight", "proposal", "expression", "communication", "progress"];
const scoreValues = radarKeys.map(k => scores[k] ?? 0);
const total = scoreValues.reduce((sum, s) => sum + s * 10, 0);

let rank = "";
if (total >= 270) rank = "Sランク（成婚力MAX）";
else if (total >= 210) rank = "Aランク（安定型）";
else if (total >= 150) rank = "Bランク（改善の余地あり）";
else if (total >= 90) rank = "Cランク（要改善）";
else rank = "Dランク（努力が必要）";

document.getElementById("totalScoreDisplay").innerText = `総合スコア：${total}点｜ランク：${rank}`;

new Chart(document.getElementById("radarChart"), {
  type: 'radar',
  data: {
    labels: radarLabels,
    datasets: [{
      label: "スコア",
      data: scoreValues,
      fill: true,
      backgroundColor: "rgba(0,123,255,0.2)",
      borderColor: "rgba(0,123,255,1)",
      pointBackgroundColor: "rgba(0,123,255,1)"
    }]
  },
  options: {
    scales: {
      r: {
        suggestedMin: 0,
        suggestedMax: 3
      }
    }
  }
});

document.getElementById("categoryScores").innerText = radarLabels.map((label, i) => `${label}：${scoreValues[i]} 点`).join(" ／ ");

const comments = {
  impression: ["第一印象に無頓着な傾向があります。笑顔や清潔感を意識するだけで印象は大きく変わります。",
               "やや表情や雰囲気作りに課題がありそうです。意識的に穏やかな印象を心がけましょう。",
               "初対面でも落ち着いた印象を与えられています。さらに笑顔を意識すれば◎",
               "第一印象は申し分なし。自然な振る舞いと柔らかい表情で安心感を与えられています。"],
  empathy: ["共感力にやや課題があります。相手の立場や感情を想像して会話をすると改善されます。",
            "相手の話に対する反応が機械的になりがちです。柔らかい相づちを意識しましょう。",
            "相手の感情に寄り添う姿勢が見られます。共通点を見つけるとより親近感が増します。",
            "自然な共感力が備わっており、信頼を得やすいタイプです。聞き役としても優れています。"],
  observation: ["相手の変化や反応を見逃しがちな傾向です。視線や表情の観察を心がけましょう。",
                "少し気配りが足りない印象です。相手のリアクションに注意を払ってみましょう。",
                "相手の表情やしぐさに気づける感性があります。自然な観察ができています。",
                "相手の雰囲気や価値観を素早くキャッチできる観察力があります。会話の質も高まります。"],
  insight: ["表面的な理解にとどまりやすい傾向です。沈黙や違和感の裏側にも注目しましょう。",
            "相手の本音に気づきづらい場面がありそうです。深掘りする質問を意識してみて。",
            "言葉の奥にある感情をある程度読み取れています。洞察の精度を高めましょう。",
            "相手の本音や背景を自然に察知できる力があります。深い信頼を得やすいタイプです。"],
  proposal: ["相手への提案が少ない傾向です。積極的に選択肢を示す姿勢が求められます。",
             "提案が曖昧だったり、相手任せになっているかもしれません。具体性を意識してみて。",
             "相手に寄り添った提案ができており、好印象を持たれやすいタイプです。",
             "相手の好みや状況に応じた的確な提案力を持ち、関係をスムーズに進展できます。"],
  expression: ["自分の魅力や価値観を表現するのが苦手な傾向があります。簡単な自己開示から始めてみて。",
               "少し控えめな印象です。ポジティブな言葉やエピソードを交えてみましょう。",
               "自身の魅力を自然に表現できており、相手に良い印象を残しています。",
               "伝え方が上手で、自信と誠実さをバランスよく伝える力があります。"],
  communication: ["一方的な会話になりがちな傾向です。相手が話しやすい質問を意識しましょう。",
                  "話題が広がりづらいと感じる場面があるかも。相手の反応を見ながら展開しましょう。",
                  "会話のキャッチボールがしっかりできており、相手も話しやすい雰囲気です。",
                  "質問と傾聴のバランスが絶妙で、深く共感されやすい会話ができています。"],
  progress: ["関係性の進展に消極的な傾向があります。次のステップを意識的に提案しましょう。",
             "少しタイミングを逃しているかもしれません。行動のきっかけを準備しておきましょう。",
             "適切なタイミングで連絡や提案ができており、自然な関係構築ができています。",
             "相手の状況や感情を読みながら理想的なペースで関係を進められるタイプです。"]
};

const advices = {
  impression: ["印象は“第一の営業提案”。笑顔・清潔感・安心感をセットで売り出そう！",
               "外見と振る舞いは名刺代わり。あなた自身が“ブランド”です。",
               "見た目＋声のトーンが最強の営業武器に！印象形成は数秒が勝負。",
               "あなたの印象は“入り口の勝者”。そのまま突き進めば結果も出ます！"],
  empathy: ["営業の基本は“共感”です。まずは相手の立場に立つ姿勢を忘れずに。",
            "共感のリアクションは“うなずき”と“言い換え”で強化しよう。",
            "聞き上手こそ最強営業マン。共感力が信頼を生みます。",
            "“わかってくれてる感”は営業成功の鍵。あなたにはその武器があります！"],
  observation: ["お客様の表情・しぐさ・声の変化＝“営業サイン”。見逃さないように。",
                "観察とは“相手に関心がある”という意思表示。日頃から磨こう。",
                "相手の関心ワードを拾って反映！観察眼が営業成果に直結します。",
                "観察力は“準備力”。あなたの強みは商談前から始まってます。"],
  insight: ["顧客の“本音”は質問の奥にあります。洞察力は深掘りから育ちます。",
            "違和感や沈黙＝チャンス。営業脳で裏側を見抜く習慣を持とう。",
            "相手の“Why”を探るのが営業の極意。そこにニーズが隠れてます。",
            "深く理解しようとする姿勢が“信頼される営業”をつくる鍵です。"],
  proposal: ["提案のない営業は存在しない。“選択肢”を示すことがあなたの役割。",
             "相手に合わせた提案＝“価値の創出”。押し売りにならない工夫を。",
             "提案は具体的に！不安要素を先回りして潰すと決定率がUPします。",
             "納得を得る提案＝“共創型営業”。あなたの提案力は頼もしい武器です。"],
  expression: ["伝えること＝営業の根幹。あなたの魅力を“棚卸し”して伝えていこう。",
               "自己表現は練習次第。短く・具体的に・前向きに！",
               "営業とは価値の翻訳者。あなたの魅力を“相手目線”で伝えよう。",
               "自己開示力＝営業信頼度。あなたの言葉が相手の心を動かします。"],
  communication: ["営業は“質問力×傾聴力”のかけ算。双方向を常に意識！",
                  "話すことより“聞くこと”が営業の8割。相手に話させよう。",
                  "“会話のリズム”が営業成果を左右します。テンポを意識して。",
                  "あなたの会話力は“信頼構築マシン”。その調子で続けよう！"],
  progress: ["進展なき営業は不成立。“次の一手”を常に準備しておこう。",
             "タイミングを逃さない営業脳＝“計画×即応”。事前準備がカギ。",
             "進展力は“予測力”。相手の反応を読みながら一歩先へ。",
             "あなたの進展力は営業の決定力。まさに成婚への推進力です！"]
};

const feedbackContainer = document.getElementById("feedbackContainer");
radarKeys.forEach((key, index) => {
  const score = scoreValues[index];
  const level = Math.min(Math.max(score, 0), 3);
  const fbBlock = document.createElement("div");
  fbBlock.className = "feedback-block";
  fbBlock.innerHTML = `
    <h3>${radarLabels[index]}</h3>
    <p>${comments[key][level]}</p>
    <p class="advice"><strong>営業脳からのアドバイス：</strong>${advices[key][level]}</p>
  `;
  feedbackContainer.appendChild(fbBlock);
});
