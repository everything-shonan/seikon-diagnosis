<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>成婚力診断結果</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #e9f4fb;
      padding: 2em;
      text-align: center;
      color: #003b63;
    }
    .container {
      background: #ffffff;
      max-width: 800px;
      margin: auto;
      padding: 2em;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 91, 154, 0.1);
    }
    h1 {
      color: #005b9a;
    }
    .comment {
      text-align: left;
      margin: 1em 0;
      padding: 1em;
      background: #f3faff;
      border-left: 5px solid #007acc;
      border-radius: 8px;
    }
    .summary {
      background: #fff3cd;
      color: #856404;
      padding: 1em;
      border-left: 5px solid #ffeeba;
      border-radius: 8px;
      margin-bottom: 2em;
      text-align: left;
    }
    .next-step {
      margin-top: 2em;
      padding: 1em;
      background: #e0f7fa;
      border-left: 4px solid #00acc1;
      border-radius: 8px;
      text-align: left;
    }
    .next-step h3 {
      margin-top: 0;
      color: #007c91;
    }
    .next-step a {
      display: inline-block;
      margin-top: 0.5em;
      background: #00acc1;
      color: white;
      padding: 0.7em 1.5em;
      border-radius: 6px;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>診断結果</h1>
    <canvas id="radarChart" width="400" height="400"></canvas>
    <div id="summary"></div>
    <div id="scoreList"></div>
    <div class="next-step">
      <h3>🔍 次のステップ</h3>
      <p>この診断結果をもとに、プロのカウンセラーによる無料相談を活用しませんか？</p>
      <a href="https://everything-shonan.jp/contact/">無料カウンセリングを予約する</a>
    </div>
  </div>

  <script>
    const scoreData = JSON.parse(localStorage.getItem('seikonScores')) || {};
    const orderedCategories = ['印象力', '共感力', '観察力', '洞察力', '提案力', '表現力', '会話力', '進展力'];
    const chartValues = orderedCategories.map(cat => scoreData[cat] || 0);

    new Chart(document.getElementById('radarChart'), {
      type: 'radar',
      data: {
        labels: orderedCategories,
        datasets: [{
          label: 'スコア',
          data: chartValues,
          backgroundColor: 'rgba(0,91,154,0.2)',
          borderColor: '#005b9a',
          pointBackgroundColor: '#005b9a'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          title: { display: true, text: '成婚力レーダーチャート' }
        },
        scales: {
          r: { min: 0, max: 30, ticks: { stepSize: 5 } }
        }
      }
    });

    function getRank(score) {
      if (score >= 27) return "S";
      if (score >= 21) return "A";
      if (score >= 15) return "B";
      return "C";
    }

    const totalScore = Object.values(scoreData).reduce((a, b) => a + b, 0);
    let overallRank = getRank(totalScore / 8);
    let advice = "";
    switch (overallRank) {
      case "S":
        advice = "あなたは成婚力が非常に高く、どの場面でも相手に好印象を与えられるタイプです。さらなる磨きをかけて成婚に近づきましょう！"; break;
      case "A":
        advice = "多くの力がバランス良く整っており、婚活において高い実力を発揮できます。あと一歩の工夫が大きな前進につながります。"; break;
      case "B":
        advice = "成婚力のベースはできていますが、いくつかの項目に改善の余地があります。今のうちに強化することで理想の出会いに繋がります。"; break;
      case "C":
        advice = "これから力をつけていく段階です。焦らず、自分に必要な部分を見直して、一歩ずつ自信を積み上げていきましょう。"; break;
    }

    document.getElementById("summary").innerHTML = `
      <div class="summary">
        <strong>総合スコア：${totalScore}点／240点</strong><br>
        <strong>総合ランク：${overallRank}</strong><br>
        ${advice}
      </div>
    `;

    const comments = {
      "印象力": { "S": "第一印象でしっかり心を掴めるあなたは、自然と信頼を得られる存在です。",
                  "A": "印象は良好で安定しています。さらに磨きをかけましょう。",
                  "B": "基本的には良い印象を持たれていますが、改善の余地があります。",
                  "C": "第一印象に改善の余地があります。身だしなみや話し方を意識してみてください。" },
      "共感力": { "S": "相手の気持ちにしっかり寄り添える力があります。",
                  "A": "共感する姿勢は良好です。自然なリアクションが信頼感につながります。",
                  "B": "共感がやや控えめな傾向があります。",
                  "C": "共感の姿勢を意識することが信頼関係構築の第一歩です。" }
      // ...（省略、実際はすべてのコメント追加）
    };

    const resultContainer = document.getElementById("scoreList");
    orderedCategories.forEach(cat => {
      const score = scoreData[cat] || 0;
      const rank = getRank(score);
      const comment = comments[cat]?.[rank] || "コメント準備中...";
      const div = document.createElement("div");
      div.className = "comment";
      div.innerHTML = `<strong>${cat}（${score}点） - ランク：${rank}</strong><br>${comment}`;
      resultContainer.appendChild(div);
    });
  </script>
</body>
</html>