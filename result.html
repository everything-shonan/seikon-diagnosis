
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>診断結果｜成婚力診断</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f0faff;
      color: #003b63;
      margin: 0;
      padding: 2em;
    }
    .container {
      max-width: 960px;
      margin: auto;
      background: white;
      padding: 2em;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    h1 {
      color: #01579b;
      text-align: center;
    }
    .score-summary {
      text-align: center;
      font-size: 1.3em;
      margin: 1em 0;
    }
    canvas {
      max-width: 100%;
      margin: 2em auto;
    }
    .feedback-block {
      margin: 2em 0;
      background: #eef7fa;
      padding: 1em;
      border-radius: 8px;
    }
    .feedback-block h3 {
      color: #007acc;
    }
    .feedback-block p.advice {
      color: #d84315;
      font-weight: bold;
    }
    .button-area {
      text-align: center;
      margin-top: 2em;
    }
    .button-area a, .button-area button {
      display: inline-block;
      margin: 0.5em;
      padding: 0.8em 1.5em;
      background: #007acc;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    .button-area a:hover, .button-area button:hover {
      background: #005b9a;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>診断結果</h1>
    <div class="score-summary" id="totalScoreDisplay"></div>
    <canvas id="radarChart" width="400" height="400"></canvas>

    <div id="feedbackContainer"></div>

    <div class="button-area">
      <a href="index.html">TOPページに戻る</a>
      <a href="https://page.line.me/everything.shonan" target="_blank">LINEで相談</a>
      <a href="https://everything-shonan.jp/contact/" target="_blank">無料カウンセリング予約</a>
      <button onclick="window.print()">PDF出力・印刷</button>
    </div>
  </div>

  <script>
    const scores = JSON.parse(sessionStorage.getItem("diagnosisScores")) || {};
    const radarLabels = ["印象力", "共感力", "観察力", "洞察力", "提案力", "表現力", "会話力", "進展力"];
    const radarKeys = ["impression", "empathy", "observation", "insight", "proposal", "expression", "communication", "progress"];
    const scoreValues = radarKeys.map(k => scores[k] ?? 0);
    const total = scoreValues.reduce((sum, s) => sum + s * 10, 0);

    let rank = "";
    if (total >= 270) rank = "Sランク（成婚力MAX）";
    else if (total >= 210) rank = "Aランク（安定型）";
    else if (total >= 150) rank = "Bランク（改善の余地あり）";
    else if (total >= 90) rank = "Cランク（要改善）";
    else rank = "Dランク（努力が必要）";

    document.getElementById("totalScoreDisplay").innerText = `総合スコア：${total}点｜ランク：${rank}`;

    new Chart(document.getElementById("radarChart"), {
      type: 'radar',
      data: {
        labels: radarLabels,
        datasets: [{
          label: "スコア",
          data: scoreValues,
          fill: true,
          backgroundColor: "rgba(0,123,255,0.2)",
          borderColor: "rgba(0,123,255,1)",
          pointBackgroundColor: "rgba(0,123,255,1)"
        }]
      },
      options: {
        scales: {
          r: {
            suggestedMin: 0,
            suggestedMax: 3
          }
        }
      }
    });

    const feedbackData = {
      "印象力": ["印象力Sコメント", "印象力Aコメント", "印象力Bコメント", "印象力Cコメント"],
      "共感力": ["共感力Sコメント", "共感力Aコメント", "共感力Bコメント", "共感力Cコメント"],
      "観察力": ["観察力Sコメント", "観察力Aコメント", "観察力Bコメント", "観察力Cコメント"],
      "洞察力": ["洞察力Sコメント", "洞察力Aコメント", "洞察力Bコメント", "洞察力Cコメント"],
      "提案力": ["提案力Sコメント", "提案力Aコメント", "提案力Bコメント", "提案力Cコメント"],
      "表現力": ["表現力Sコメント", "表現力Aコメント", "表現力Bコメント", "表現力Cコメント"],
      "会話力": ["会話力Sコメント", "会話力Aコメント", "会話力Bコメント", "会話力Cコメント"],
      "進展力": ["進展力Sコメント", "進展力Aコメント", "進展力Bコメント", "進展力Cコメント"]
    };

    const adviceData = {
      "印象力": ["印象力Sアドバイス", "印象力Aアドバイス", "印象力Bアドバイス", "印象力Cアドバイス"],
      "共感力": ["共感力Sアドバイス", "共感力Aアドバイス", "共感力Bアドバイス", "共感力Cアドバイス"],
      "観察力": ["観察力Sアドバイス", "観察力Aアドバイス", "観察力Bアドバイス", "観察力Cアドバイス"],
      "洞察力": ["洞察力Sアドバイス", "洞察力Aアドバイス", "洞察力Bアドバイス", "洞察力Cアドバイス"],
      "提案力": ["提案力Sアドバイス", "提案力Aアドバイス", "提案力Bアドバイス", "提案力Cアドバイス"],
      "表現力": ["表現力Sアドバイス", "表現力Aアドバイス", "表現力Bアドバイス", "表現力Cアドバイス"],
      "会話力": ["会話力Sアドバイス", "会話力Aアドバイス", "会話力Bアドバイス", "会話力Cアドバイス"],
      "進展力": ["進展力Sアドバイス", "進展力Aアドバイス", "進展力Bアドバイス", "進展力Cアドバイス"]
    };

    const feedbackContainer = document.getElementById("feedbackContainer");

    radarKeys.forEach((key, i) => {
      const label = radarLabels[i];
      const score = scores[key] ?? 0;
      let level = 3;
      if (score >= 3) level = 0;
      else if (score === 2) level = 1;
      else if (score === 1) level = 2;

      const comment = feedbackData[label][level];
      const advice = adviceData[label][level];

      feedbackContainer.innerHTML += `
        <div class="feedback-block">
          <h3>${label}</h3>
          <p><strong>診断コメント：</strong>${comment}</p>
          <p class="advice"><strong>営業脳アドバイス：</strong>${advice}</p>
        </div>
      `;
    });
  </script>
</body>
</html>
